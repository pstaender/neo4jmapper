<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/cypherquery.js</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../prettify.css">
    <link rel="stylesheet" href="../base.css">
    <style type='text/css'>
        div.coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class="header high">
    <h1>Code coverage report for <span class="entity">src/cypherquery.js</span></h1>
    <h2>
        Statements: <span class="metric">82.28% <small>(65 / 79)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Branches: <span class="metric">68.75% <small>(33 / 48)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Functions: <span class="metric">100% <small>(6 / 6)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Lines: <span class="metric">82.28% <small>(65 / 79)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../index.html">All files</a> &#187; <a href="index.html">src/</a> &#187; cypherquery.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">4914</span>
<span class="cline-any cline-yes">4914</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-yes">4914</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-yes">4914</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-yes">4914</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">522</span>
<span class="cline-any cline-yes">522</span>
<span class="cline-any cline-yes">522</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">522</span>
<span class="cline-any cline-yes">522</span>
<span class="cline-any cline-yes">522</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-yes">522</span>
<span class="cline-any cline-yes">1518</span>
<span class="cline-any cline-yes">1518</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1500</span>
<span class="cline-any cline-yes">1500</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1500</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1500</span>
<span class="cline-any cline-yes">1500</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1500</span>
<span class="cline-any cline-yes">1500</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1226</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1226</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">274</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1500</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">522</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">522</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1008</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">521</span>
<span class="cline-any cline-yes">521</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-yes">521</span>
<span class="cline-any cline-yes">521</span>
<span class="cline-any cline-yes">521</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">4</span>
<span class="cline-any cline-yes">4</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">397</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-yes">397</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">397</span>
<span class="cline-any cline-yes">227</span>
<span class="cline-any cline-yes">397</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">427</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">397</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">&nbsp;
<span class="missing-if-branch" title="if path not taken" >I</span>if (typeof window === 'object') {
<span class="cstat-no" title="statement not covered" >  var _ = window._;</span>
<span class="cstat-no" title="statement not covered" >  var helpers = window.Neo4jMapper.helpers;</span>
} else {
  var _ = require('underscore');
  var helpers = require('./helpers');
}
&nbsp;
var CypherQuery = function CypherQuery(query, parameters) {
  this.statements = [];
  <span class="missing-if-branch" title="if path not taken" >I</span>if (typeof query === 'string')
<span class="cstat-no" title="statement not covered" >    this.query = query;</span>
  else <span class="missing-if-branch" title="if path not taken" >I</span>if (typeof query === 'object')
<span class="cstat-no" title="statement not covered" >    this.statements = query;</span>
  <span class="missing-if-branch" title="if path not taken" >I</span>if (parameters)
<span class="cstat-no" title="statement not covered" >    this.parameters = parameters;</span>
  this.cypher = _.extend(CypherQuery.prototype.cypher);
}
&nbsp;
CypherQuery.prototype.statementsToString = function(options) {
  var s = '';
  var chopLength = 15;
  var defaultOptions = {
    niceFormat: true
  };
  <span class="missing-if-branch" title="else path not taken" >E</span>if (this.statements) {
    <span class="missing-if-branch" title="else path not taken" >E</span>if (typeof options !== 'object')
      options = {};
    else
<span class="cstat-no" title="statement not covered" >      _.defaults(options, defaultOptions);</span>
    for (var i=0; i &lt; this.statements.length; i++) {
      var queryFragment = this.statements[i];
      if (typeof queryFragment === 'string') {
        // if we have just a string, we add the string to final query, no manipulation
        s += queryFragment;
        continue;
      }
      var attribute = Object.keys(this.statements[i])[0];
      <span class="missing-if-branch" title="if path not taken" >I</span>if ((typeof queryFragment === 'object') &amp;&amp; (typeof queryFragment.toQueryString === 'function')) {
<span class="cstat-no" title="statement not covered" >        queryFragment = queryFragment.toQueryString();</span>
<span class="cstat-no" title="statement not covered" >        s += queryFragment;</span>
<span class="cstat-no" title="statement not covered" >        continue;</span>
      }
      var forQuery = this.statements[i][attribute];
      // do we have an object with a .toQueryString() method?
&nbsp;
      // remove underscore from attribute, e.g. ORDER_BY -&gt; ORDER BY
      attribute = attribute.replace(/([A-Z]{1})\_([A-Z]{1})/g, '$1 $2');
      <span class="missing-if-branch" title="if path not taken" >I</span>if (options.niceFormat) {
        // extend attribute-string with whitespace
<span class="cstat-no" title="statement not covered" >        attribute = attribute + Array(chopLength - attribute.length).join(' ');</span>
      }
      <span class="missing-if-branch" title="else path not taken" >E</span>if (forQuery !== null) {
        if (typeof forQuery === 'string') {
          // remove dupliacted statement fragment identifier, e.g. START START … -&gt; START …
          forQuery = forQuery.trim().replace(new RegExp('^'+attribute+'\\s+', 'i'), '');
          // remove trailing semicolon
          forQuery = forQuery.replace(/\;$/, '');
        } else {
          forQuery = String(forQuery);
        }
        s += '\n'+attribute+' '+forQuery+' ';
      }
    }
    s = s.trim().replace(/;+$/,'');
  }
  return s + ';';
}
&nbsp;
CypherQuery.prototype.query = '';         // the cypher query string
CypherQuery.prototype.parameters = null;
CypherQuery.prototype.statements = null;
CypherQuery.prototype.cypher = {};
CypherQuery.prototype.useParameters = true;
&nbsp;
CypherQuery.prototype.hasParameters = function() {
  return ((this.parameters) &amp;&amp; (typeof this.parameters === 'object') &amp;&amp; (Object.keys(this.parameters).length &gt; 0));
}
&nbsp;
CypherQuery.prototype.toCypher = function(options) {
  var s = '';
  <span class="missing-if-branch" title="if path not taken" >I</span>if (this.query)
<span class="cstat-no" title="statement not covered" >    s = this.query;</span>
  else <span class="missing-if-branch" title="else path not taken" >E</span>if (this.statements.length &gt; 0)
    s = this.statementsToString(options);
  return s;
}
&nbsp;
CypherQuery.prototype.toString = function(options) {
  var s = this.toCypher(options);
  if ((s)&amp;&amp;(this.hasParameters())) {
    // replace identifiers with values to present a good equivalent
    for (var key in this.parameters) {
      var value = this.parameters[key];
      // TODO: better check that we detect placeholders
      s = s.replace('{'+key+'}', helpers.valueToStringForCypherQuery(value, "'"));
    };
  }
  return s;
}
&nbsp;
CypherQuery.prototype.addParameters = function(parameters) {
  <span class="missing-if-branch" title="if path not taken" >I</span>if (typeof parameters !== 'object')
<span class="cstat-no" title="statement not covered" >    throw Error('parameter(s) as argument must be an object, e.g. { key: "value" }')</span>
  <span class="missing-if-branch" title="if path not taken" >I</span>if (this.useParameters === null)
<span class="cstat-no" title="statement not covered" >    this.useParameters = true;</span>
  // reset parameters
  if ((!this.hasParameters()) || ((parameters !== null) &amp;&amp; (Object.keys(parameters).length === 0)))
    this.parameters = {};
  for (var attr in parameters) {
    // replace undefined values with null because we can't work with undefined values in neo4j
    this.parameters[attr] = (parameters[attr] === undefined) ? <span class="branch-0 cbranch-no" title="branch not covered" >null </span>: parameters[attr];
  }
  return this;
}
&nbsp;
CypherQuery.prototype.addParameter = CypherQuery.prototype.addParameters;
&nbsp;
<span class="missing-if-branch" title="if path not taken" >I</span>if (typeof window === 'object') {
<span class="cstat-no" title="statement not covered" >  window.Neo4jMapper.CypherQuery = CypherQuery;</span>
} else {
  module.exports = exports = CypherQuery;
}</pre></td></tr>
</table></pre>

</div>
<div class="footer">
    <div class="meta">Generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Mon May 25 2015 18:43:30 GMT+0200 (CEST)</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
